{
  "info": {
    "_postman_id": "autonomous-alpha-api-v1.8.0",
    "name": "Autonomous Alpha API v1.8.0",
    "description": "Sovereign Tier Infrastructure - HITL Approval Gateway & Guardian API\n\n**SOVEREIGN MANDATE:** Survival > Capital Preservation > Alpha\n\nThis collection tests all API endpoints for Project Autonomous Alpha including:\n- System health and status\n- Guardian lock management\n- HITL (Human-in-the-Loop) approval gateway\n- Trade lifecycle management\n- Budget and RGI status",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "string",
      "description": "Base URL for the API server"
    },
    {
      "key": "operator_id",
      "value": "sovereign_operator",
      "type": "string",
      "description": "Operator ID for HITL authentication"
    },
    {
      "key": "guardian_admin_token",
      "value": "",
      "type": "string",
      "description": "Guardian admin token for unlock operations"
    },
    {
      "key": "test_trade_id",
      "value": "",
      "type": "string",
      "description": "Trade ID for HITL approval tests (set dynamically)"
    }
  ],
  "item": [
    {
      "name": "System",
      "description": "System health and status endpoints",
      "item": [
        {
          "name": "Root - System Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/",
              "host": ["{{base_url}}"],
              "path": [""]
            },
            "description": "Returns the current system status and health information including all component statuses."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has required fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('system');",
                  "    pm.expect(jsonData).to.have.property('version');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('tier');",
                  "    pm.expect(jsonData).to.have.property('components');",
                  "});",
                  "",
                  "pm.test('System is operational', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('operational');",
                  "});",
                  "",
                  "pm.test('Tier is SOVEREIGN', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.tier).to.eql('SOVEREIGN');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Lightweight health check for load balancers and monitoring."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 503', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 503]);",
                  "});",
                  "",
                  "pm.test('Response has status field', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});",
                  "",
                  "pm.test('Database status is present', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('database');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Prometheus Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/metrics",
              "host": ["{{base_url}}"],
              "path": ["metrics"]
            },
            "description": "Exposes Prometheus metrics for observability."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Content-Type is Prometheus format', function () {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/plain');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Guardian",
      "description": "Guardian Service - Hard Stop Protection endpoints",
      "item": [
        {
          "name": "Guardian Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/guardian/status",
              "host": ["{{base_url}}"],
              "path": ["guardian", "status"]
            },
            "description": "Returns current Guardian lock status and daily P&L metrics."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has required fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('system_locked');",
                  "    pm.expect(jsonData).to.have.property('daily_pnl_zar');",
                  "    pm.expect(jsonData).to.have.property('loss_limit_zar');",
                  "    pm.expect(jsonData).to.have.property('loss_remaining_zar');",
                  "    pm.expect(jsonData).to.have.property('timestamp');",
                  "});",
                  "",
                  "pm.test('ZAR values are formatted correctly', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.daily_pnl_zar).to.match(/^R /);",
                  "    pm.expect(jsonData.loss_limit_zar).to.match(/^R /);",
                  "    pm.expect(jsonData.loss_remaining_zar).to.match(/^R /);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Guardian Unlock (Requires Auth)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{guardian_admin_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"reason\": \"Manual unlock for testing - Postman collection run\",\n    \"correlation_id\": \"POSTMAN-TEST-{{$timestamp}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/guardian/unlock",
              "host": ["{{base_url}}"],
              "path": ["guardian", "unlock"]
            },
            "description": "Manually unlock the Guardian lock with full audit trail.\n\n**SOVEREIGN MANDATE:** This action is logged at CRITICAL level.\n\n**Authentication:** Requires Bearer token (GUARDIAN_ADMIN_TOKEN)."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Note: This test may return 400 if system is not locked, or 401/403 if auth fails",
                  "pm.test('Status code is valid response', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 401, 403, 503]);",
                  "});",
                  "",
                  "pm.test('Response has expected structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (pm.response.code === 200) {",
                  "        pm.expect(jsonData).to.have.property('success');",
                  "        pm.expect(jsonData).to.have.property('message');",
                  "        pm.expect(jsonData).to.have.property('correlation_id');",
                  "    } else {",
                  "        pm.expect(jsonData).to.have.property('detail');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "HITL Approval Gateway",
      "description": "Human-in-the-Loop Approval Gateway endpoints\n\n**PRIME DIRECTIVE:** The bot thinks. You approve. The system never betrays you.",
      "item": [
        {
          "name": "Get Pending Approvals",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_id}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/hitl/pending",
              "host": ["{{base_url}}"],
              "path": ["api", "hitl", "pending"]
            },
            "description": "Returns all pending HITL approval requests ordered by expiry time.\n\n**Authentication:** Bearer token required (SEC-001 if missing)\n\n**Ordering:** Soonest expiry first (expires_at ASC)"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 401', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response is an array', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.be.an('array');",
                  "    });",
                  "    ",
                  "    pm.test('If pending approvals exist, they have required fields', function () {",
                  "        const jsonData = pm.response.json();",
                  "        if (jsonData.length > 0) {",
                  "            const approval = jsonData[0];",
                  "            pm.expect(approval).to.have.property('trade_id');",
                  "            pm.expect(approval).to.have.property('instrument');",
                  "            pm.expect(approval).to.have.property('side');",
                  "            pm.expect(approval).to.have.property('risk_pct');",
                  "            pm.expect(approval).to.have.property('confidence');",
                  "            pm.expect(approval).to.have.property('expires_at');",
                  "            pm.expect(approval).to.have.property('seconds_remaining');",
                  "            pm.expect(approval).to.have.property('correlation_id');",
                  "            // Store first trade_id for subsequent tests",
                  "            pm.collectionVariables.set('test_trade_id', approval.trade_id);",
                  "        }",
                  "    });",
                  "} else {",
                  "    pm.test('Unauthorized response has SEC-001 error code', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.detail.error_code).to.eql('SEC-001');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Pending Approvals (No Auth - Should Fail)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/hitl/pending",
              "host": ["{{base_url}}"],
              "path": ["api", "hitl", "pending"]
            },
            "description": "Test that missing authentication returns SEC-001 error."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401 (Unauthorized)', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Error code is SEC-001', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.error_code).to.eql('SEC-001');",
                  "});",
                  "",
                  "pm.test('Error message mentions Authorization header', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.message).to.include('Authorization');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Approve Trade (Template)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_id}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"approved_by\": \"{{operator_id}}\",\n    \"channel\": \"WEB\",\n    \"comment\": \"Approved via Postman test collection\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/hitl/{{test_trade_id}}/approve",
              "host": ["{{base_url}}"],
              "path": ["api", "hitl", "{{test_trade_id}}", "approve"]
            },
            "description": "Approve a pending HITL trade request.\n\n**Authentication:** Bearer token required\n\n**Authorization:** Operator must be in HITL_ALLOWED_OPERATORS\n\n**Rate Limiting:** 2 second cooldown between actions"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Valid responses: 200 (success), 401 (no auth), 403 (unauthorized), 422 (invalid trade_id), 429 (rate limited)",
                  "pm.test('Status code is valid response', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 401, 403, 410, 422, 429, 500]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Approval response has required fields', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.have.property('status');",
                  "        pm.expect(jsonData.status).to.eql('APPROVED');",
                  "        pm.expect(jsonData).to.have.property('trade_id');",
                  "        pm.expect(jsonData).to.have.property('decided_at');",
                  "        pm.expect(jsonData).to.have.property('correlation_id');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Reject Trade (Template)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_id}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"rejected_by\": \"{{operator_id}}\",\n    \"channel\": \"WEB\",\n    \"reason\": \"Rejected via Postman test collection - market conditions unfavorable\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/hitl/{{test_trade_id}}/reject",
              "host": ["{{base_url}}"],
              "path": ["api", "hitl", "{{test_trade_id}}", "reject"]
            },
            "description": "Reject a pending HITL trade request.\n\n**Authentication:** Bearer token required\n\n**Authorization:** Operator must be in HITL_ALLOWED_OPERATORS\n\n**Reason Required:** A rejection reason must be provided"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Valid responses: 200 (success), 401 (no auth), 403 (unauthorized), 422 (invalid trade_id), 429 (rate limited)",
                  "pm.test('Status code is valid response', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 401, 403, 410, 422, 429, 500]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Rejection response has required fields', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.have.property('status');",
                  "        pm.expect(jsonData.status).to.eql('REJECTED');",
                  "        pm.expect(jsonData).to.have.property('trade_id');",
                  "        pm.expect(jsonData).to.have.property('decided_at');",
                  "        pm.expect(jsonData).to.have.property('correlation_id');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Approve Trade (Unauthorized Operator - Should Fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer unauthorized_user",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"approved_by\": \"unauthorized_user\",\n    \"channel\": \"WEB\",\n    \"comment\": \"This should fail\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/hitl/00000000-0000-0000-0000-000000000000/approve",
              "host": ["{{base_url}}"],
              "path": ["api", "hitl", "00000000-0000-0000-0000-000000000000", "approve"]
            },
            "description": "Test that unauthorized operators receive SEC-090 error."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 403 (Forbidden)', function () {",
                  "    pm.response.to.have.status(403);",
                  "});",
                  "",
                  "pm.test('Error code is SEC-090', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.error_code).to.eql('SEC-090');",
                  "});",
                  "",
                  "pm.test('Error message mentions unauthorized', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.message.toLowerCase()).to.include('not authorized');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Trade Lifecycle",
      "description": "Trade Lifecycle Manager endpoints (Phase 2)",
      "item": [
        {
          "name": "Trade Lifecycle Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/trade-lifecycle/status",
              "host": ["{{base_url}}"],
              "path": ["trade-lifecycle", "status"]
            },
            "description": "Returns the current Trade Lifecycle Manager status and trade counts by state."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 503', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 503]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response has required fields', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.have.property('status');",
                  "        pm.expect(jsonData).to.have.property('guardian_locked');",
                  "        pm.expect(jsonData).to.have.property('trades_by_state');",
                  "        pm.expect(jsonData).to.have.property('timestamp');",
                  "    });",
                  "    ",
                  "    pm.test('Guardian locked is boolean', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.guardian_locked).to.be.a('boolean');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Trades by State (PENDING)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/trade-lifecycle/trades/PENDING",
              "host": ["{{base_url}}"],
              "path": ["trade-lifecycle", "trades", "PENDING"]
            },
            "description": "Returns all trades in PENDING lifecycle state."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200, 400, or 503', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 503]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response is an array', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.trades).to.be.an('array');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Budget & RGI",
      "description": "BudgetGuard and Reward-Governed Intelligence endpoints",
      "item": [
        {
          "name": "Budget Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/budget/status",
              "host": ["{{base_url}}"],
              "path": ["budget", "status"]
            },
            "description": "Returns the current BudgetGuard integration status and Net Alpha."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 500', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 500]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response has required fields', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.have.property('status');",
                  "        pm.expect(jsonData).to.have.property('strict_mode');",
                  "        pm.expect(jsonData).to.have.property('can_trade');",
                  "        pm.expect(jsonData).to.have.property('timestamp');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Budget Refresh",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/budget/refresh",
              "host": ["{{base_url}}"],
              "path": ["budget", "refresh"]
            },
            "description": "Reloads the BudgetGuard JSON file and updates operational gating."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 500', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 500]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response has success field', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.have.property('success');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "RGI Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/rgi/status",
              "host": ["{{base_url}}"],
              "path": ["rgi", "status"]
            },
            "description": "Returns the current Reward-Governed Intelligence system status."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 500', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 500]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response has required fields', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData).to.have.property('status');",
                  "        pm.expect(jsonData).to.have.property('model_loaded');",
                  "        pm.expect(jsonData).to.have.property('safe_mode_active');",
                  "        pm.expect(jsonData).to.have.property('timestamp');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ]
}
